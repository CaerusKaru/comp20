
// geoOptions for enhanced geotracking
var geoOptions = {
    enableHighAccuracy: true,
    maximumAge: 0,
    timeout: 30000
};

// processLocation -- takes in a position and performs basic operations
function processLocation(lat, lng) {
    // following code courtesy of Stack Overflow 
    var http = new XMLHttpRequest();
    var url = "https://defense-in-derpth.herokuapp.com/sendLocation";
    var params = "login=CAROLE_BRENNAN&lat=" + lat + "&lng=" + lng;
    alert(params);
    http.open("POST", url, true);

    http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    http.setRequestHeader("Content-type", params.length);
    http.setRequestHeader("Connection", "close");

    http.addEventListener("load", dbResponse);
    
    http.send(params);
};

function dbResponse() {
    alert(this.responseText);
    alert(JSON.parse(this.responseText));
};

function errorCall(e) {
    alert('ERROR(' + e.code + '): ' + e.message);
};

function init() {
    alert("In init");
    if (navgiator.geolocation) {
	navigator.geolocation.getCurrentPosition(function(position) {
	    processLocation(position.coords.latitude, position.coords.longitude);
	}, errorCall, geoOptions);
    }
    else {
	alert("Your browser does not support geolocation!");
    }
    alert("Done with init");
};
